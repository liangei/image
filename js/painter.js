!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Painter={})}(this,(function(t){"use strict";const e={upx2px:t=>window.innerWidth/750*t,getSystemInfoSync:()=>({screenWidth:window.innerWidth}),getImageInfo:({src:t,success:e,fail:i})=>{const o=new Image;o.onload=function(){e({width:this.naturalWidth,height:this.naturalHeight,path:this.src,src:t})},o.onerror=i,o.src=t}},i="object"==typeof swan?"mp-baidu":"object"==typeof tt?"mp-toutao":"object"==typeof window?"undefined"==typeof uni||"undefined"!=typeof uni&&!uni?.addInterceptor?"web":"h5":"mp-weixin",o="undefined"!=typeof uni?uni.upx2px?uni:Object.assign(uni,e):"undefined"!=typeof window?e:"mp-weixin"==i?wx:uni;if(!o.upx2px){let t=(o.getSystemInfoSync().screenWidth??375)/750;o.upx2px=e=>t*e}function r(t){return/^-?\d+(\.\d+)?$/.test(t)}function s(t,e,i){if("number"==typeof t)return t;if(r(t))return 1*t;if("string"==typeof t){const r=/^-?([0-9]+)?([.]{1}[0-9]+){0,1}(em|rpx|px|%)$/g.exec(t);if(!t||!r)return 0;const n=r[3];t=parseFloat(t);let a=0;return"rpx"===n?a=o.upx2px(t):"px"===n?a=1*t:"%"===n&&e?a=t*s(e)/100:"em"===n&&e&&(a=t*s(e||14)),i?1*a.toFixed(2):Math.round(a)}return 0}function n(t){return new Promise(((e,i)=>o.getImageInfo({src:t,success:t=>e(t),fail:i})))}var a={isGradient:t=>!(!t||!t.startsWith("linear")&&!t.startsWith("radial")),doGradient(t,e,i,o){t.startsWith("linear")?function(t,e,i,o){const r=function(t,e,i){const o=t.match(/([-]?\d{1,3})deg/);let r;switch(o&&o[1]?parseFloat(o[1]):0){case 0:r=[0,-i/2,0,i/2];break;case 90:r=[e/2,0,-e/2,0];break;case-90:r=[-e/2,0,e/2,0];break;case 180:r=[0,i/2,0,-i/2];break;case-180:r=[0,-i/2,0,i/2];break;default:let t=0,s=0,n=0,a=0;o[1]>0&&o[1]<90?(t=e/2-(e/2*Math.tan((90-o[1])*Math.PI*2/360)-i/2)*Math.sin(2*(90-o[1])*Math.PI*2/360)/2,a=Math.tan((90-o[1])*Math.PI*2/360)*t,n=-t,s=-a):o[1]>-180&&o[1]<-90?(t=-e/2+(e/2*Math.tan((90-o[1])*Math.PI*2/360)-i/2)*Math.sin(2*(90-o[1])*Math.PI*2/360)/2,a=Math.tan((90-o[1])*Math.PI*2/360)*t,n=-t,s=-a):o[1]>90&&o[1]<180?(t=e/2+(-e/2*Math.tan((90-o[1])*Math.PI*2/360)-i/2)*Math.sin(2*(90-o[1])*Math.PI*2/360)/2,a=Math.tan((90-o[1])*Math.PI*2/360)*t,n=-t,s=-a):(t=-e/2-(-e/2*Math.tan((90-o[1])*Math.PI*2/360)-i/2)*Math.sin(2*(90-o[1])*Math.PI*2/360)/2,a=Math.tan((90-o[1])*Math.PI*2/360)*t,n=-t,s=-a),r=[t,s,n,a]}return r}(i,t,e),s=o.createLinearGradient(r[0],r[1],r[2],r[3]),n=i.match(/linear-gradient\((.+)\)/)[1],a=h(n.substring(n.indexOf(",")+1));for(let t=0;t<a.colors.length;t++)s.addColorStop(a.percents[t],a.colors[t]);o.setFillStyle(s)}(e,i,t,o):t.startsWith("radial")&&function(t,e,i,o){const r=h(i.match(/radial-gradient\((.+)\)/)[1]),s=o.createCircularGradient(0,0,t<e?e/2:t/2);for(let t=0;t<r.colors.length;t++)s.addColorStop(r.percents[t],r.colors[t]);o.setFillStyle(s)}(e,i,t,o)}};function h(t){const e=t.substring(0,t.length-1).split("%,"),i=[],o=[];for(let t of e)i.push(t.substring(0,t.lastIndexOf(" ")).trim()),o.push(t.substring(t.lastIndexOf(" "),t.length)/100);return{colors:i,percents:o}}function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function l(){return(l=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t}).apply(this,arguments)}var c=0,f={left:null,top:null,width:null,height:null},u=function(){function t(t,e,i,o){var r=this;d(this,"id",c++),d(this,"style",l({},f)),d(this,"computedStyle",{}),d(this,"children",{}),d(this,"layoutBox",l({},f)),d(this,"contentSize",l({},f,{maxLineHeight:0})),d(this,"clientSize",l({},f)),d(this,"borderSize",l({},f)),d(this,"offsetSize",l({},f)),this.ctx=o,this.root=i,e&&(this.parent=e),this.name=t.name||t.type,this.attributes=this.getAttributes(t);var s=this.getComputedStyle(t,null==e?void 0:e.computedStyle);this.isAbsolute="absolute"==s.position,this.isFixed="fixed"==s.position,Object.keys(s).forEach((function(t){Object.defineProperty(r.style,t,{configurable:!0,enumerable:!0,get:function(){return s[t]},set:function(e){s[t]=e}})}));var n={contentSize:l({},this.contentSize),clientSize:l({},this.clientSize),borderSize:l({},this.borderSize),offsetSize:l({},this.offsetSize)};Object.keys(n).forEach((function(t){Object.keys(r[t]).forEach((function(e){Object.defineProperty(r[t],e,{configurable:!0,enumerable:!0,get:function(){return n[t][e]},set:function(i){n[t][e]=i}})}))})),this.computedStyle=this.style}var e=t.prototype;return e.add=function(t){t.parent=this,this.children[t.id]=t},e.remove=function(t){var e=this;t?this.children[t.id]&&(t.remove(),delete this.children[t.id]):Object.keys(this.children).forEach((function(t){e.children[t].remove(),delete e.children[t]}))},e.getChildren=function(){var t=this;return Object.keys(this.children).map((function(e){return t.children[e]}))},e.getComputedStyle=function(t,e){var i=["color","fontSize","lineHeight","verticalAlign","fontWeight","textAlign"],o=t.css,n=void 0===o?{}:o,a=t.type,h=void 0===a?"view":a,d={};if(e)for(var l=0;l<i.length;l++){var c=i[l];(n[c]||e[c])&&(n[c]=n[c]||e[c])}for(var f=function(){var t=g[u],e=n[t];if(/^(box)?shadow$/i.test(t)){var i=e.split(" ").map((function(t){return/^\d/.test(t)?s(t):t}));return d.boxShadow=i,"continue"}if(/^border/i.test(t)&&!/radius$/i.test(t)){var o,a=t.match(/^border([BTRLa-z]+)?/)[0],l=t.match(/[W|S|C][a-z]+/),c=e.replace(/([\(,])\s+|\s+([\),])/g,"$1$2").split(" ").map((function(t){return/^\d/.test(t)?s(t,"",!0):t}));return d[a]=((o={})[a+"Width"]=(r(c[0])?c[0]:0)||1,o[a+"Style"]=c[1]||"solid",o[a+"Color"]=c[2]||"black",o),1==c.length&&l&&(d[a][a+l[0]]=c[0]),"continue"}if(/^background(color)?$/i.test(t))return d.backgroundColor=e,"continue";if(/^objectPosition$/i.test(t))return d[t]=e.split(" "),"continue";if(/padding|margin|radius/i.test(t)){var f=/radius$/i.test(t),p=f?"borderRadius":t.match(/[a-z]+/)[0],b=[0,0,0,0].map((function(t,e){return f?["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"][e]:[p+"Top",p+"Right",p+"Bottom",p+"Left"][e]}));if("padding"===t||"margin"===t||/^(border)?radius$/i.test(t)){var m,w=(null==e?void 0:e.split(" ").map((function(e){return/^\d+(rpx|px)?$/.test(e)?s(e):"margin"!=t&&/auto/.test(e)?0:e}),[]))||[0],x=f?"borderRadius":t,v=w[0],y=w[1],S=w[2],z=w[3];d[x]=((m={})[b[0]]="auto"==v?0:v,m[b[1]]=r(y)?y:v,m[b[2]]="auto"==(r(S)?S:v)?0:r(S)?S:v,m[b[3]]=r(z)?z:y||v,m)}else{var B;if("object"==typeof d[p])d[p][t]="margin"==p&&"auto"==e||/%$/.test(e)?e:s(e);else d[p]=((B={})[b[0]]=d[p]||0,B[b[1]]=d[p]||0,B[b[2]]=d[p]||0,B[b[3]]=d[p]||0,B),d[p][t]="margin"==p&&"auto"==e||/%$/.test(e)?e:s(e)}return"continue"}if(/^transform$/i.test(t))return d[t]={},e.replace(/([a-zA-Z]+)\(([0-9,-\.%rpxdeg\s]+)\)/g,(function(e,i,o){var r=o.split(",").map((function(t){return t.replace(/(^\s*)|(\s*$)/g,"")})),a=function(t,e){return t.includes("deg")?1*t:e&&!/%$/.test(e)?s(t,e):t};i.includes("matrix")?d[t][i]=r.map((function(t){return 1*t})):i.includes("rotate")?d[t][i]=1*o.match(/^-?\d+(\.\d+)?/)[0]:/[X, Y]/.test(i)?d[t][i]=/[X]/.test(i)?a(r[0],n.width):a(r[0],n.height):(d[t][i+"X"]=a(r[0],n.width),d[t][i+"Y"]=a(r[1]||r[0],n.height))})),"continue";/^left|top$/i.test(t)&&!["absolute","fixed"].includes(n.position)?d[t]=0:d[t]=/^[\d\.]+(px|rpx)?$/.test(e)?s(e):/em$/.test(e)&&"text"==h?s(e,n.fontSize):e},u=0,g=Object.keys(n);u<g.length;u++)f();return d},e.setPosition=function(t,e){var i={left:"width",top:"height",right:"width",bottom:"height"};Object.keys(i).forEach((function(o){["right","bottom"].includes(o)&&void 0!==t.style[o]?t.style["right"==o?"left":"top"]=e[i[o]]-t.offsetSize[i[o]]-s(t.style[o],e[i[o]]):t.style[o]=s(t.style[o],e[i[o]])}))},e.getAttributes=function(t){var e=t.attributes||{};return(null!=t&&t.url||null!=t&&t.src)&&(e.src=e.src||t.url||(null==t?void 0:t.src)),t.replace&&(e.replace=t.replace),null!=t&&t.text&&(e.text=t.text),e},e.getOffsetSize=function(t,e,i){void 0===i&&(i="offsetSize");var o=e||{},r=o.margin,s=(r=void 0===r?{}:r).marginLeft,n=void 0===s?0:s,a=r.marginTop,h=void 0===a?0:a,d=r.marginRight,l=void 0===d?0:d,c=r.marginBottom,f=void 0===c?0:c,u=o.padding,g=(u=void 0===u?{}:u).paddingLeft,p=void 0===g?0:g,b=u.paddingTop,m=void 0===b?0:b,w=u.paddingRight,x=void 0===w?0:w,v=u.paddingBottom,y=void 0===v?0:v,S=o.border,z=(S=void 0===S?{}:S).borderWidth,B=void 0===z?0:z,R=o.borderTop,M=(R=void 0===R?{}:R).borderTopWidth,k=void 0===M?B:M,I=o.borderBottom,P=(I=void 0===I?{}:I).borderBottomWidth,T=void 0===P?B:P,O=o.borderRight,L=(O=void 0===O?{}:O).borderRightWidth,W=void 0===L?B:L,j=o.borderLeft,C=(j=void 0===j?{}:j).borderLeftWidth,$=void 0===C?B:C;return"contentSize"==i&&(this[i].left=t.left+n+p+$,this[i].top=t.top+h+m+k,this[i].width=t.width,this[i].height=t.height),"clientSize"==i&&(this[i].left=t.left+n+$,this[i].top=t.top+h+k,this[i].width=t.width+p+x,this[i].height=t.height+m+y),"borderSize"==i&&(this[i].left=t.left+n+$/2,this[i].top=t.top+h+k/2,this[i].width=t.width+p+x+$/2+W/2,this[i].height=t.height+m+y+T/2+k/2),"offsetSize"==i&&(this[i].left=t.left,this[i].top=t.top,this[i].width=t.width+p+x+$+W+n+l,this[i].height=t.height+m+y+T+k+f+h),this[i]},e.layoutBoxUpdate=function(t,e,i,o){if(void 0===i&&(i=""),"border-box"==(null==e?void 0:e.boxSizing)){var r=e||{},s=r.border,n=(s=void 0===s?{}:s).borderWidth,a=void 0===n?0:n,h=r.borderTop,d=(h=void 0===h?{}:h).borderTopWidth,l=void 0===d?a:d,c=r.borderBottom,f=(c=void 0===c?{}:c).borderBottomWidth,u=void 0===f?a:f,g=r.borderRight,p=(g=void 0===g?{}:g).borderRightWidth,b=void 0===p?a:p,m=r.borderLeft,w=(m=void 0===m?{}:m).borderLeftWidth,x=void 0===w?a:w,v=r.padding,y=(v=void 0===v?{}:v).paddingTop,S=void 0===y?0:y,z=v.paddingRight,B=void 0===z?0:z,R=v.paddingBottom,M=void 0===R?0:R,k=v.paddingLeft,I=void 0===k?0:k;"width"==i&&(t.width-=I+B+b+x),"height"!=i||o||(t.height-=S+M+l+u)}this.layoutBox.contentSize=this.getOffsetSize(t,e,"contentSize"),this.layoutBox.clientSize=this.getOffsetSize(t,e,"clientSize"),this.layoutBox.borderSize=this.getOffsetSize(t,e,"borderSize"),this.layoutBox.offsetSize=this.getOffsetSize(t,e,"offsetSize"),this.layoutBox=Object.assign({},this.layoutBox,this.layoutBox.borderSize)},e.getBoxPosition=function(t){var e=this.computedStyle,i=this.getChildren(),o=e.verticalAlign,r=e.left,s=void 0===r?0:r,n=e.top,a=void 0===n?0:n;e.width,e.height,e.padding,e.margin;var h=l({},this.contentSize,{left:s,top:a}),d=this.contentSize.top-this.offsetSize.top,c=this.contentSize.left-this.offsetSize.left,f=0;if("bottom"==o&&this.contentSize.maxLineHeight?f=this.contentSize.maxLineHeight-this.contentSize.height:"middle"==o&&this.contentSize.maxLineHeight&&(f=(this.contentSize.maxLineHeight-this.contentSize.height)/2),h.top+=f,i.length){s+=c,a+=d;for(var u=null,g=null,p=!1,b=0;b<i.length;b++){var m=i[b];if(m.isAbsolute||m.isFixed)m.isAbsolute?(m.setPosition(m,h),m.style.left+=s,m.style.top+=a,m.getBoxPosition()):(m.setPosition(m,this.root),m.getBoxPosition());else if(0==b)m.style.left+=s,m.style.top+=a,m.getBoxPosition(),u=m,g=m;else{var w,x,v,y;(null==(w=g)?void 0:w.offsetSize.height)<(null==(x=u)?void 0:x.offsetSize.height)&&(g=u);var S=(null==(v=u)?void 0:v.offsetSize.left)+(null==(y=u)?void 0:y.offsetSize.width)+m.offsetSize.width>h.left+h.width+c;if(this.getBoxState(u,m)||S){var z,B,R,M;if(m.style.left+=s,(null==(z=u)?void 0:z.offsetSize.height)>=(null==(B=g)?void 0:B.offsetSize.height))m.style.top+=u.offsetSize.top+u.offsetSize.height||0;else m.style.top+=(null==(R=g)?void 0:R.offsetSize.top)+(null==(M=g)?void 0:M.offsetSize.height)||0;m.getBoxPosition(),u=m,g=m,p=!0}else m.style.left+=u.offsetSize.left+u.offsetSize.width,m.style.top+=p?u.offsetSize.top:a,m.getBoxPosition(),u=m}}this.layoutBoxUpdate(h,e)}else this.layoutBoxUpdate(h,e);return this.layoutBox},e.setMaxLineHeight=function(t,e,i){for(var o=t;o>=0&&!e[o].contentSize.maxLineHeight;)e[o].contentSize.maxLineHeight=i,o--},e.getBoxState=function(t,e){return"view"==e.name&&"inline-block"!==e.style.display||"view"==(null==t?void 0:t.name)&&"inline-block"!==(null==t?void 0:t.style.display)||"block"==e.style.display||"block"==(null==t?void 0:t.style.display)},e.getBoxHieght=function(){var t,e=this,i=this.name,o=this.computedStyle,r=this.attributes,n=this.parent,a=this.getChildren();o.left;var h=o.top,d=o.bottom;o.width;var c=o.height,f=void 0===c?0:c,u=o.fontSize,g=void 0===u?14:u,p=o.position;o.padding,o.margin;var b=o.lineHeight,m=void 0===b?"1.4em":b,w=o.lineClamp,x=l({},this.contentSize);if("image"==i&&null==f){var v=r.width,y=r.height;r.mode,x.height=Math.round(x.width*y/v)||0,this.layoutBoxUpdate(x,o,"height")}else if(f)if(a.length){var S=null,z=0;a.forEach((function(t,i){var o,r,s=i==a.length-1;t.getBoxHieght();var n=(null==(o=S)?void 0:o.offsetSize.left)+(null==(r=S)?void 0:r.offsetSize.width)+t.offsetSize.width>x.left+x.width,h=e.getBoxState(S,t);if(n||h){if(n){for(var d=i-1;d>=0&&!a[d].contentSize.maxLineHeight;)z<a[d].contentSize.height&&(z=a[d].contentSize.height),d--;e.setMaxLineHeight(i-1,a,z),z=0}}else if(s){for(var l=i;l>=0&&!a[l].contentSize.maxLineHeight;)z<a[l].contentSize.height&&(z=a[l].contentSize.height),l--;e.setMaxLineHeight(i,a,z),z=0}S=t}))}else this.layoutBoxUpdate(x,o,"height");else{var B=0;if(h&&(this.isAbsolute||this.isFixed&&n.contentSize.height)){var R="absolute"==p?n.contentSize.height:this.root.height;B=R-(/%$/.test(h)?s(h,R):h)-(/%$/.test(d)?s(d,R):d)}if("text"==i){m=s(m,g);var M=this.attributes.widths.length;this.attributes.widths.forEach((function(t){return t.widths.reduce((function(t,e,i){return t+e>x.width?(M++,e):t+e}),0)})),M=w&&M>w?w:M,x.height=B||M*m,this.layoutBoxUpdate(x,o,"height",!0)}else if(a.length){var k=0,I=null,P=0;x.height=a.reduce((function(t,i,o){var r=o==a.length-1;if(i.isAbsolute||i.isFixed)return r?t+k:t;i.getBoxHieght();var s=e.getBoxState(I,i),n=P+i.offsetSize.width>x.width;if(n||s){var h,d,l=0;return n||I&&("view"!==(null==(h=I)?void 0:h.name)||"inline-block"==(null==(d=I)?void 0:d.style.display))?(r&&(e.setMaxLineHeight(o-1,a,k),k+=i.offsetSize.height),l=t+k,k=i.offsetSize.height,P=i.offsetSize.width,I=i,l):(P=0,k=0,t+i.offsetSize.height)}return P+=i.offsetSize.width,k=Math.max(k,i.offsetSize.height)||0,r?(e.setMaxLineHeight(o,a,k),t+k):(I=i,t)}),0),B&&(x.height=B),this.layoutBoxUpdate(x,o)}else B&&(x.height=B),this.layoutBoxUpdate(x,o,"height")}if(o.borderRadius&&null!=(t=this.borderSize)&&t.width)for(var T in o.borderRadius)Object.hasOwnProperty.call(o.borderRadius,T)&&(o.borderRadius[T]=s(o.borderRadius[T],this.borderSize.width));return this.layoutBox},e.contrastSize=function(t,e,i){var o=t;return i&&(o=Math.min(o,i)),e&&(o=Math.max(o,e)),o},e.getBoxWidth=function(){var t,e=this,i=this.name,o=this.computedStyle,r=this.attributes,n=this.parent,a=void 0===n?{}:n,h=this.ctx,d=this.getChildren(),l=o.left,c=void 0===l?0:l;o.top;var f=o.right,u=o.width,g=void 0===u?0:u,p=o.minWidth,b=o.maxWidth,m=o.height,w=void 0===m?0:m,x=o.fontSize,v=void 0===x?14:x,y=o.fontWeight,S=o.fontFamily,z=o.textStyle,B=o.position,R=o.display,M=o.padding,k=void 0===M?{}:M,I=o.margin,P=void 0===I?{}:I,T=o.border,O=(T=void 0===T?{}:T).borderWidth,L=void 0===O?0:O,W=o.borderRight,j=(W=void 0===W?{}:W).borderRightWidth,C=void 0===j?L:j,$=o.borderLeft,F=($=void 0===$?{}:$).borderLeftWidth,A=void 0===F?L:F;if(/%$/.test(g)&&(g=s(g,a.contentSize.width,!0)),/%$/.test(w)&&(w=s(w,a.contentSize.height)),/%$/.test(p)&&(p=s(p,a.contentSize.width,!0)),/%$/.test(b)&&(b=s(b,a.contentSize.width,!0)),o.padding&&null!=(t=a.contentSize)&&t.width)for(var H in o.padding)Object.hasOwnProperty.call(o.padding,H)&&(o.padding[H]=s(o.padding[H],a.contentSize.width));var U=k.paddingRight,G=void 0===U?0:U,D=k.paddingLeft,E=void 0===D?0:D;if(o.margin&&[o.margin.marginLeft,o.margin.marginRight].includes("auto"))if(g){var N=a.contentSize.width-g-G-E-A-C||0;o.margin.marginLeft==o.margin.marginRight?o.margin.marginLeft=o.margin.marginRight=N/2:"auto"==o.margin.marginLeft?o.margin.marginLeft=N:o.margin.marginRight=N}else o.margin.marginLeft=o.margin.marginRight=0;var X=P.marginRight,V=void 0===X?0:X,Y=P.marginLeft,q={width:g,height:w,left:0,top:0},J=E+G+A+C+(void 0===Y?0:Y)+V;if("text"==i){var _=r.text||"";h.save(),h.setFonts({fontFamily:S,fontSize:v,fontWeight:y,textStyle:z}),_.split("\n").map((function(t){var i=t.split("").map((function(t){return h.measureText(t,v).width}));e.attributes.widths||(e.attributes.widths=[]),e.attributes.widths.push({widths:i,total:i.reduce((function(t,e){return t+e}),0)})})),h.restore()}if("image"==i&&null==g){var Q=r.width,Z=r.height;q.width=this.contrastSize(Math.round(Q*w/Z)||0,p,b),this.layoutBoxUpdate(q,o,"width")}else if(g)d.length?(this.layoutBoxUpdate(q,o,"width"),d.forEach((function(t){t.getBoxWidth()}))):this.layoutBoxUpdate(q,o,"width");else{var K=0;if((this.isAbsolute||this.isFixed)&&a.contentSize.width){var tt="absolute"==B?a.contentSize.width:this.root.width;K=tt-(/%$/.test(c)?s(c,tt):c)-(/%$/.test(f)?s(f,tt):f)}if("text"==i){var et=this.attributes.widths,it=Math.max.apply(Math,et.map((function(t){return t.total})));if(a&&a.contentSize.width>0&&(it>a.contentSize.width||"block"==R)&&!this.isAbsolute&&!this.isFixed)it=a.contentSize.width-J;q.width=K||this.contrastSize(it,p,b),this.layoutBoxUpdate(q,o,"width")}else if("view"!=i||!a||"inline-block"===R||this.isAbsolute||this.isFixed)if(d.length){for(var ot=0,rt=null,st=0;d.length>st;){var nt=d[st],at=st==d.length-1,ht=this.getBoxState(rt,nt);if(!nt.isFixed&&!nt.isAbsolute)if(!rt||ht){var dt=nt.getBoxWidth();ot=Math.max(ot,dt.width)||0,rt=nt}else if(rt.offsetSize.left+rt.offsetSize.width+nt.offsetSize.width<a.contentSize.width&&st!==d.length-1){ot+=nt.getBoxWidth().width,rt=nt}else{var lt=nt.getBoxWidth();at?ot+=lt.width:ot=a.contentSize.width,rt=null}st++}q.width=K||this.contrastSize(Math.ceil(ot),p,b),d.forEach((function(t){"block"!=t.style.display||"text"!=t.name||t.isFixed||t.isAbsolute||t.style.width||(t.style.width=q.width-J,t.getBoxWidth())})),this.layoutBoxUpdate(q,o,"width")}else q.width=K,this.layoutBoxUpdate(q,o,"width");else q.width=this.contrastSize(a.contentSize.width-J,p,b),this.layoutBoxUpdate(q,o),d.length&&d.forEach((function(t){t.getBoxWidth()}))}return this.layoutBox},e.layout=function(){return this.getBoxWidth(),this.getBoxHieght(),this.getBoxPosition(),this.offsetSize},t}(),g=function(){var t,e,i,o,r,s,n=[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28],a=[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177],h=[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],d=[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],l=[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175],c=[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],f=[],u=[],g=[],p=[],b=[],m=2;function w(t,e){var i;t>e&&(i=t,t=e,e=i),i=e,i*=e,i+=e,i>>=1,p[i+=t]=1}function x(t,i){var o;for(g[t+e*i]=1,o=-2;o<2;o++)g[t+o+e*(i-2)]=1,g[t-2+e*(i+o+1)]=1,g[t+2+e*(i+o)]=1,g[t+o+1+e*(i+2)]=1;for(o=0;o<2;o++)w(t-1,i+o),w(t+1,i-o),w(t-o,i-1),w(t+o,i+1)}function v(t){for(;t>=255;)t=((t-=255)>>8)+(255&t);return t}var y=[];function S(t,e,i,o){var r,s,n;for(r=0;r<o;r++)f[i+r]=0;for(r=0;r<e;r++){if(255!=(n=l[f[t+r]^f[i]]))for(s=1;s<o;s++)f[i+s-1]=f[i+s]^c[v(n+y[o-s])];else for(s=i;s<i+o;s++)f[s]=f[s+1];f[i+o-1]=255==n?0:c[v(n+y[0])]}}function z(t,e){var i;return t>e&&(i=t,t=e,e=i),i=e,i+=e*e,i>>=1,p[i+=t]}function B(t){var i,o,r,s;switch(t){case 0:for(o=0;o<e;o++)for(i=0;i<e;i++)i+o&1||z(i,o)||(g[i+o*e]^=1);break;case 1:for(o=0;o<e;o++)for(i=0;i<e;i++)1&o||z(i,o)||(g[i+o*e]^=1);break;case 2:for(o=0;o<e;o++)for(r=0,i=0;i<e;i++,r++)3==r&&(r=0),r||z(i,o)||(g[i+o*e]^=1);break;case 3:for(s=0,o=0;o<e;o++,s++)for(3==s&&(s=0),r=s,i=0;i<e;i++,r++)3==r&&(r=0),r||z(i,o)||(g[i+o*e]^=1);break;case 4:for(o=0;o<e;o++)for(r=0,s=o>>1&1,i=0;i<e;i++,r++)3==r&&(r=0,s=!s),s||z(i,o)||(g[i+o*e]^=1);break;case 5:for(s=0,o=0;o<e;o++,s++)for(3==s&&(s=0),r=0,i=0;i<e;i++,r++)3==r&&(r=0),(i&o&1)+!(!r|!s)||z(i,o)||(g[i+o*e]^=1);break;case 6:for(s=0,o=0;o<e;o++,s++)for(3==s&&(s=0),r=0,i=0;i<e;i++,r++)3==r&&(r=0),(i&o&1)+(r&&r==s)&1||z(i,o)||(g[i+o*e]^=1);break;case 7:for(s=0,o=0;o<e;o++,s++)for(3==s&&(s=0),r=0,i=0;i<e;i++,r++)3==r&&(r=0),(r&&r==s)+(i+o&1)&1||z(i,o)||(g[i+o*e]^=1)}}function R(t){var e,i=0;for(e=0;e<=t;e++)b[e]>=5&&(i+=3+b[e]-5);for(e=3;e<t-1;e+=2)b[e-2]==b[e+2]&&b[e+2]==b[e-1]&&b[e-1]==b[e+1]&&3*b[e-1]==b[e]&&(0==b[e-3]||e+3>t||3*b[e-3]>=4*b[e]||3*b[e+3]>=4*b[e])&&(i+=40);return i}function M(){var t,i,o,r,s,n=0,a=0;for(i=0;i<e-1;i++)for(t=0;t<e-1;t++)(g[t+e*i]&&g[t+1+e*i]&&g[t+e*(i+1)]&&g[t+1+e*(i+1)]||!(g[t+e*i]||g[t+1+e*i]||g[t+e*(i+1)]||g[t+1+e*(i+1)]))&&(n+=3);for(i=0;i<e;i++){for(b[0]=0,o=r=t=0;t<e;t++)(s=g[t+e*i])==r?b[o]++:b[++o]=1,a+=(r=s)?1:-1;n+=R(o)}a<0&&(a=-a);var h=a,d=0;for(h+=h<<2,h<<=1;h>e*e;)h-=e*e,d++;for(n+=10*d,t=0;t<e;t++){for(b[0]=0,o=r=i=0;i<e;i++)(s=g[t+e*i])==r?b[o]++:b[++o]=1,r=s;n+=R(o)}return n}var k=null;return{api:{get ecclevel(){return m},set ecclevel(t){m=t},get size(){return _size},set size(t){_size=t},get canvas(){return k},set canvas(t){k=t},getFrame:function(b){return function(b){var R,k,I,P,T,O,L,W;P=b.length,t=0;do{if(t++,I=4*(m-1)+16*(t-1),i=d[I++],o=d[I++],r=d[I++],s=d[I],P<=(I=r*(i+o)+o-3+(t<=9)))break}while(t<40);for(e=17+4*t,T=r+(r+s)*(i+o)+o,P=0;P<T;P++)u[P]=0;for(f=b.slice(0),P=0;P<e*e;P++)g[P]=0;for(P=0;P<(e*(e+1)+1)/2;P++)p[P]=0;for(P=0;P<3;P++){for(I=0,k=0,1==P&&(I=e-7),2==P&&(k=e-7),g[k+3+e*(I+3)]=1,R=0;R<6;R++)g[k+R+e*I]=1,g[k+e*(I+R+1)]=1,g[k+6+e*(I+R)]=1,g[k+R+1+e*(I+6)]=1;for(R=1;R<5;R++)w(k+R,I+1),w(k+1,I+R+1),w(k+5,I+R),w(k+R+1,I+5);for(R=2;R<4;R++)g[k+R+e*(I+2)]=1,g[k+2+e*(I+R+1)]=1,g[k+4+e*(I+R)]=1,g[k+R+1+e*(I+4)]=1}if(t>1)for(P=n[t],k=e-7;;){for(R=e-7;R>P-3&&(x(R,k),!(R<P));)R-=P;if(k<=P+9)break;x(6,k-=P),x(k,6)}for(g[8+e*(e-8)]=1,k=0;k<7;k++)w(7,k),w(e-8,k),w(7,k+e-7);for(R=0;R<8;R++)w(R,7),w(R+e-8,7),w(R,e-8);for(R=0;R<9;R++)w(R,8);for(R=0;R<8;R++)w(R+e-8,8),w(8,R);for(k=0;k<7;k++)w(8,k+e-7);for(R=0;R<e-14;R++)1&R?(w(8+R,6),w(6,8+R)):(g[8+R+6*e]=1,g[6+e*(8+R)]=1);if(t>6)for(P=a[t-7],I=17,R=0;R<6;R++)for(k=0;k<3;k++,I--)1&(I>11?t>>I-12:P>>I)?(g[5-R+e*(2-k+e-11)]=1,g[2-k+e-11+e*(5-R)]=1):(w(5-R,2-k+e-11),w(2-k+e-11,5-R));for(k=0;k<e;k++)for(R=0;R<=k;R++)g[R+e*k]&&w(R,k);for(T=f.length,O=0;O<T;O++)u[O]=f.charCodeAt(O);if(f=u.slice(0),T>=(R=r*(i+o)+o)-2&&(T=R-2,t>9&&T--),O=T,t>9){for(f[O+2]=0,f[O+3]=0;O--;)P=f[O],f[O+3]|=255&P<<4,f[O+2]=P>>4;f[2]|=255&T<<4,f[1]=T>>4,f[0]=64|T>>12}else{for(f[O+1]=0,f[O+2]=0;O--;)P=f[O],f[O+2]|=255&P<<4,f[O+1]=P>>4;f[1]|=255&T<<4,f[0]=64|T>>4}for(O=T+3-(t<10);O<R;)f[O++]=236,f[O++]=17;for(y[0]=1,O=0;O<s;O++){for(y[O+1]=1,L=O;L>0;L--)y[L]=y[L]?y[L-1]^c[v(l[y[L]]+O)]:y[L-1];y[0]=c[v(l[y[0]]+O)]}for(O=0;O<=s;O++)y[O]=l[y[O]];for(I=R,k=0,O=0;O<i;O++)S(k,r,I,s),k+=r,I+=s;for(O=0;O<o;O++)S(k,r+1,I,s),k+=r+1,I+=s;for(k=0,O=0;O<r;O++){for(L=0;L<i;L++)u[k++]=f[O+L*r];for(L=0;L<o;L++)u[k++]=f[i*r+O+L*(r+1)]}for(L=0;L<o;L++)u[k++]=f[i*r+O+L*(r+1)];for(O=0;O<s;O++)for(L=0;L<i+o;L++)u[k++]=f[R+O+L*s];for(f=u,R=k=e-1,I=T=1,W=(r+s)*(i+o)+o,O=0;O<W;O++)for(P=f[O],L=0;L<8;L++,P<<=1){128&P&&(g[R+e*k]=1);do{T?R--:(R++,I?0!=k?k--:(I=!I,6==(R-=2)&&(R--,k=9)):k!=e-1?k++:(I=!I,6==(R-=2)&&(R--,k-=8))),T=!T}while(z(R,k))}for(f=g.slice(0),P=0,k=3e4,I=0;I<8&&(B(I),(R=M())<k&&(k=R,P=I),7!=P);I++)g=f.slice(0);for(P!=I&&B(P),k=h[P+(m-1<<3)],I=0;I<8;I++,k>>=1)1&k&&(g[e-1-I+8*e]=1,I<6?g[8+e*I]=1:g[8+e*(I+1)]=1);for(I=0;I<7;I++,k>>=1)1&k&&(g[8+e*(e-7+I)]=1,I?g[6-I+8*e]=1:g[7+8*e]=1);return g}(b)},utf16to8:function(t){var e,i,o,r;for(e="",o=t.length,i=0;i<o;i++)(r=t.charCodeAt(i))>=1&&r<=127?e+=t.charAt(i):r>2047?(e+=String.fromCharCode(224|r>>12&15),e+=String.fromCharCode(128|r>>6&63),e+=String.fromCharCode(128|r>>0&63)):(e+=String.fromCharCode(192|r>>6&31),e+=String.fromCharCode(128|r>>0&63));return e},draw:function(t,i,o,r,s){i.drawView(o,r);var n=i.ctx,a=o.contentSize,h=a.width,d=a.height;r.borderRadius,r.backgroundColor;var l=r.color,c=void 0===l?"#000000":l;r.border;var f=o.contentSize.left-o.borderSize.left,u=o.contentSize.top-o.borderSize.top;if(m=s||m,n){n.save(),i.setOpacity(r);var g=i.setTransform(o,r),p=g.x,b=g.y;p+=f,b+=u;var w=Math.min(h,d);t=this.utf16to8(t);var x=this.getFrame(t),v=w/e;n.setFillStyle(c);for(var y=0;y<e;y++)for(var S=0;S<e;S++)x[S*e+y]&&n.fillRect(p+v*y,b+v*S,v,v);n.restore(),i.setBorder(o,r)}else console.warn("No canvas provided to draw QR code in!")}}}}();class p{id;ctx;pixelRatio;width;height;platform;sleep;progress;canvas;size;count=0;root;isRate;node;component;isDraw=!0;constructor({id:t,context:e,canvas:o,pixelRatio:r,width:s,height:n},a){var h,d;this.id=t,this.canvas=o,this.pixelRatio=1*r.toFixed(2),this.width=s,this.height=n,this.platform=i,this.isRate=!1,this.component=a,this.ctx=(d=this,(h=e).setFonts=({fontFamily:t="sans-serif",fontSize:e=14,fontWeight:i="normal",textStyle:o="normal"})=>{"mp-toutao"==d.platform?(i="bold"==i?"bold":"",o="italic"==o?"italic":""):h.font=`${o} ${i} ${e}px ${t}`},h.draw?h:Object.assign(h,{setStrokeStyle(t){h.strokeStyle=t},setLineWidth(t){h.lineWidth=t},setLineCap(t){h.lineCap=t},setFillStyle(t){h.fillStyle=t},setFontSize(t){h.font=`${String(t)}px sans-serif`},setGlobalAlpha(t){h.globalAlpha=t},setLineJoin(t){h.lineJoin=t},setTextAlign(t){h.textAlign=t},setMiterLimit(t){h.miterLimit=t},setShadow(t,e,i,o){h.shadowOffsetX=t,h.shadowOffsetY=e,h.shadowBlur=i,h.shadowColor=o},setTextBaseline(t){h.textBaseline=t},createCircularGradient(){},draw(){}})),this.sleep=1e3/30,this.progress=0,this.root={width:s,height:n,fontSizeRate:1};const l={...this.size};Object.defineProperty(this,"size",{configurable:!0,set:t=>{Object.keys(t).forEach((e=>{l[e]=t[e],this.root[e]=t[e]}))},get:()=>l}),this.init()}init(){this.canvas.height&&(this.canvas.height=this.root.height*this.pixelRatio,this.canvas.width=this.root.width*this.pixelRatio,this.ctx.scale(this.pixelRatio,this.pixelRatio))}setFontSizeRate(){return this.isRate?Promise.resolve(!0):new Promise(((t,e)=>{const{ctx:i,pixelRatio:r}=this;let s=100,n=14;i.save(),i.fillRect(0,0,n,s),i.setTextBaseline("top"),i.setFillStyle("white"),i.setFontSize("100"),i.fillText("国",0,0),i.draw();const a=(e,i=1)=>{let o=-1,r=0;n*=i,s*=i;for(let t=0;t<s;t++)for(let i=0;i<n;i++){if(0!=e[4*(t*n+i)]){r++,-1==o&&(o=t);break}if(i==n-1&&-1!=o){t=s;break}}this.root.fontSizeRate=Math.min(Math.max(.6,r/(100*i)),1),this.isRate=!0,t(!0)},h={canvasId:i.id||i.canvasId,x:0,y:0,width:n,height:s,success:t=>a(t.data),fail:()=>{console.log(arguments),t(!0)}};if(i.getImageData){const t=i.getImageData(0,0,n*r,s*r);a(t.data,r)}else i.canvasGetImageData?i.canvasGetImageData(h):o.canvasGetImageData(h,this.component);i.restore(),this.clear()}))}clear(){this.ctx.clearRect(0,0,this.root.width,this.root.height)}roundRect(t,e,i,o,r,s=!1,n=!1){if(r<0)return;const{ctx:a}=this;if(a.beginPath(),r){let{borderTopLeftRadius:s=r||0,borderTopRightRadius:n=r||0,borderBottomRightRadius:h=r||0,borderBottomLeftRadius:d=r||0}=r||{};a.arc(t+i-h,e+o-h,h,0,.5*Math.PI),a.lineTo(t+d,e+o),a.arc(t+d,e+o-d,d,.5*Math.PI,Math.PI),a.lineTo(t,e+s),a.arc(t+s,e+s,s,Math.PI,1.5*Math.PI),a.lineTo(t+i-n,e),a.arc(t+i-n,e+n,n,1.5*Math.PI,2*Math.PI),a.lineTo(t+i,e+o-h)}else a.rect(t,e,i,o);a.closePath(),n&&a.stroke(),s&&a.fill()}setTransform(t,{transform:e,transformOrigin:i="center center",position:o}){const{ctx:n}=this;let{scaleX:a=1,scaleY:h=1,translateX:d=0,translateY:l=0,rotate:c=0,skewX:f=0,skewY:u=0}=e||{},{left:g,top:p,width:b,height:m}=t;if(!["absolute","fixed"].includes(o))return{x:g,y:p,w:b,h:m};d=s(d,b)||0,l=s(l,m)||0;const w={top:s("0%",1),center:s("50%",1,!0),bottom:s("100%",1)},x={left:s("0%",1),center:s("50%",1,!0),right:s("100%",1)};i=i.split(" ").filter(((t,e)=>e<2)).reduce(((t,e)=>{if(/\d+/.test(e)){let i=s(e,1,!0)/(/px|rpx$/.test(e)?r(t.x)?m:b:1);return r(t.x)?Object.assign(t,{y:i}):Object.assign(t,{x:i})}return r(x[e])&&!r(t.x)?Object.assign(t,{x:x[e]}):Object.assign(t,{y:w[e]||.5})}),{}),n.scale(a,h);const v={x:b*(a>0?1:-1)*i.x+(g+d)/a,y:m*(h>0?1:-1)*i.y+(p+l)/h};return n.translate(v.x,v.y),c&&n.rotate(c*Math.PI/180),(f||u)&&n.transform(1,Math.tan(u*Math.PI/180),Math.tan(f*Math.PI/180),1,0,0),{x:-b*i.x,y:-m*i.y,w:b,h:m}}setBackground(t,e,i){const{ctx:o}=this;t?a.isGradient(t)?a.doGradient(t,e,i,o):o.setFillStyle(t):["mp-toutiao","mp-baidu"].includes(this.platform)?o.setFillStyle("transparent"):o.setFillStyle("rgba(0,0,0,0)")}setShadow({boxShadow:t=[]}){const{ctx:e}=this;if(t.length){const[i,o,r,s]=t;e.setShadow(i,o,r,s)}}setBorder(t,e){const{ctx:i}=this;let{width:o,height:r}=t;const{border:s,borderBottom:n,borderTop:a,borderRight:h,borderLeft:d,borderRadius:l}=e,{borderWidth:c=0,borderStyle:f,borderColor:u}=s||{},{borderBottomWidth:g=c,borderBottomStyle:p=f,borderBottomColor:b=u}=n||{},{borderTopWidth:m=c,borderTopStyle:w=f,borderTopColor:x=u}=a||{},{borderLeftWidth:v=c,borderLeftStyle:y=f,borderLeftColor:S=u}=d||{};let{borderTopLeftRadius:z=l||0,borderTopRightRadius:B=l||0,borderBottomRightRadius:R=l||0,borderBottomLeftRadius:M=l||0}=l||{};if(!(n||d||a||h||s))return;const k=(t,e,o)=>{"dashed"==e?/mp/.test(this.platform)?i.setLineDash([Math.ceil(4*t/3),Math.ceil(4*t/3)]):i.setLineDash([Math.ceil(6*t),Math.ceil(6*t)]):"dotted"==e&&i.setLineDash([t,t]),i.setStrokeStyle(o)},I=(t,e,o,r,s,n,a,h,d,l,c,f,u,g)=>{i.save(),i.setLineWidth(f),k(f,u,g),i.beginPath(),i.arc(t,e,a,Math.PI*d,Math.PI*l),i.lineTo(o,r),i.arc(s,n,h,Math.PI*l,Math.PI*c),i.stroke(),i.restore()};i.save(),this.setOpacity(e);let{x:P,y:T}=this.setTransform(t,e);s&&(i.setLineWidth(c),k(c,f,u),this.roundRect(P,T,o,r,l,!1,!!u),i.restore()),n&&I(P+o-R,T+r-R,P+M,T+r,P+M,T+r-M,R,M,.25,.5,.75,g,p,b),d&&I(P+M,T+r-M,P,T+z,P+z,T+z,M,z,.75,1,1.25,v,y,S),a&&I(P+z,T+z,P+o-B,T,P+o-B,T+B,z,B,1.25,1.5,1.75,m,w,x),h&&I(P+o-B,T+B,P+o,T+r-R,P+o-R,T+r-R,B,R,1.75,2,.25,m,w,x)}setOpacity({opacity:t=1}){this.ctx.setGlobalAlpha(t)}async drawPattern(t,e,i){return new Promise(((o,r)=>{const{ctx:s,canvas:n}=this,{width:a,height:h}=e;let{borderRadius:d=0,backgroundColor:l="transparent",backgroundImage:c,backgroundRepeat:f="repeat"}=i||{};s.save(),this.setOpacity(i);let{x:u,y:g}=this.setTransform(e,i);this.setShadow(i),this.setBackground(l,a,h),this.roundRect(u,g,a,h,d,!0,!1);const p=t=>{const r=s.createPattern(t.src,f);s.setFillStyle(r),this.roundRect(u,g,a,h,d,!0,!1),this.setBorder(e,i),s.restore(),o()};if(c)if(n.createImage||"web"==this.platform){let e=null;e=n.createImage?n.createImage():new Image,e.onload=()=>{t.src=e,p(t)},e.onerror=async()=>{console.log(`createImage fail: ${JSON.stringify(t)}`),o()},e.src=t.path}else p(t)}))}drawView(t,e,i=!0,o=!0,r=!0){const{ctx:s}=this,{width:n,height:a}=t;let{borderRadius:h=0,backgroundColor:d="transparent"}=e||{};s.save(),this.setOpacity(e);let{x:l,y:c}=this.setTransform(t,e);r&&this.setShadow(e),i&&this.setBackground(d,n,a),this.roundRect(l,c,n,a,h,i,!1),s.restore(),o&&this.setBorder(t,e)}async drawImage(t,e={},i={},o=!0){await new Promise((async(r,a)=>{i.boxShadow&&this.drawView(e,Object.assign(i,{backgroundColor:i.backgroundColor||i.boxShadow&&(i.backgroundColor||"#ffffff")}),!0,!1,!0);const{ctx:h,sleep:d,canvas:l}=this;let{borderRadius:c=0,backgroundColor:f="transparent",objectFit:u="fill",objectPosition:g}=i,{width:p,height:b,left:m,top:w}=e;h.save();let x=e.contentSize.left-e.borderSize.left,v=e.contentSize.top-e.borderSize.top;if(!o){this.setOpacity(i);let{x:t,y:o}=this.setTransform(e,i);this.setBackground(f,p,b),m=t,w=o,this.roundRect(m,w,p,b,c,!!c,!1)}m+=x,w+=v,h.clip();const y=t=>{if("fill"!==u){let{sx:i,sy:o,sh:r,sw:n,dx:a,dy:d,dh:l,dw:c}=function(t,e,i){const{objectFit:o,objectPosition:r}=t;let n=e.width/e.height,a=i.width/i.height,h=1;"contain"==o&&n>=a||"cover"==o&&n<a?h=e.height/i.height:("contain"==o&&n<a||"cover"==o&&n>=a)&&(h=e.width/i.width);let d=i.width*h,l=i.height*h,c=/^\d+px|rpx$/.test(r?.[0])?s(r?.[0],e.width):(e.width-d)*(/%$/.test(r?.[0])?s(r?.[0],1,!0):{left:0,center:.5,right:1}[r?.[0]||"center"]),f=/^\d+px|rpx$/.test(r?.[1])?s(r?.[1],e.height):(e.height-l)*(/%$/.test(r?.[1])?s(r?.[1],1,!0):{top:0,center:.5,bottom:1}[r?.[1]||"center"]),u=(t,e)=>[(t-c)/h,(e-f)/h],[g,p]=u(0,0),[b,m]=u(e.width,e.height);return{sx:Math.max(g,0),sy:Math.max(p,0),sw:Math.min(b-g,i.width),sh:Math.min(m-p,i.height),dx:Math.max(c,0),dy:Math.max(f,0),dw:Math.min(d,e.width),dh:Math.min(l,e.height)}}({objectFit:u,objectPosition:g},e.contentSize,t);"mp-baidu"==this.platform?h.drawImage(t.src,a+m,d+w,c,l,i,o,n,r):h.drawImage(t.src,i,o,n,r,a+m,d+w,c,l)}else h.drawImage(t.src,m,w,p,b)},S=()=>{h.restore(),this.drawView(e,i,!1,!0,!1),setTimeout(r,d)},z=t=>{if(l.createImage||"web"==this.platform){let e=null;e=l.createImage?l.createImage():new Image,e.onload=()=>{t.src=e,y(t),S()},e.onerror=async()=>{console.log(`createImage fail: ${JSON.stringify(t)}`),r(!0)},e.src=t.path}else y(t),S()};if("string"==typeof t){const{path:e,width:i,height:o}=await n(t);z({path:e,src:e,width:i,height:o})}else z(t)}))}drawText(t,e,i,o){this.drawView(e,i);const{ctx:r}=this;let{borderSize:n,contentSize:a}=e,{width:h,height:d}=a,l=a.left-n.left,c=a.top-n.top,{color:f="#000000",lineHeight:u="1.4em",fontSize:g=14,fontWeight:p,fontFamily:b,textStyle:m,textAlign:w="left",verticalAlign:x="middle",backgroundColor:v,lineClamp:y,textDecoration:S}=i;u=s(u,g);let z=g*this.root.fontSizeRate;if(!t)return;r.save(),this.setOpacity(i);let{x:B,y:R}=this.setTransform(e,i);B+=l,R+=c,r.setFonts({fontFamily:b,fontSize:g,fontWeight:p,textStyle:m}),r.setTextBaseline("middle"),r.translate(0,-g/2),r.setTextAlign(w),R+=g,r.setFillStyle(f);let M={};if(o&&o.word.length>0)for(let e=0;e<o.word.length;e++){let i,r=0;for(;(i=t.indexOf(o.word[e],r))>-1;){M[i]={reset:!0};for(let t=0;t<o.word[e].length;t++)M[i+t]={reset:!0};r=i+1}}switch(w){case"left":break;case"center":B+=.5*h;break;case"right":B+=h}const k=r.measureText(t).width,I=(u-z)/2,P=(t,e,i)=>{let o=t;switch(w){case"left":t=t,o+=i;break;case"center":o=(t-=i/2)+i;break;case"right":o=t,t-=i}S&&(r.setLineWidth(g/13),r.beginPath(),e-=I,/\bunderline\b/.test(S)&&(r.moveTo(t,e-.5*z),r.lineTo(o,e-.5*z)),/\boverline\b/.test(S)&&(r.moveTo(t,e-1.5*z),r.lineTo(o,e-1.5*z)),/\bline-through\b/.test(S)&&(r.moveTo(t,e-z),r.lineTo(o,e-z)),r.closePath(),r.setStrokeStyle(f),r.stroke())},T=(t,e,i)=>{const s=Object.keys(M);for(let t=0;t<s.length;t++){const e=M[s[t]];r.save(),r.setFillStyle(o.color),e.char&&r.fillText(e.char,e.x,e.y),r.restore()}},O=(t,e)=>{if(t){const t=Math.round(r.measureText(" ").width),i=Math.round(r.measureText("　").width),o=Math.round(r.measureText(e).width);let s="",n=1;return o==i?(s="　",n=1):(s=" ",n=Math.ceil(o/t)),{char:new Array(n).fill(s).join(""),width:o}}return{char:e}},L=(t,e,i,o)=>{M[e].x=i,M[e].y=o,M[e].char=t},W=(t,e,i,o,{startIndex:s=0,endIndex:n})=>{let a=i;/·/.test(i)&&(a=a.replace(/·/g,"."),o=r.measureText(a).width);let h=i.split(""),d=t;for(let i=0;i<e.length;i++){const n=e[i],l=n-s,c=h[l];if(c){let{char:e,width:i}=O(M[n],c);h[l]=e,"center"==w&&(d=t-.5*(o-i)),"right"==w&&(d=t-o+i),L(c,n,d+r.measureText(a.substring(0,l)).width,R+I)}}return h};if(k<=a.width&&!t.includes("\n")){const o=Object.keys(M);let s="";return o&&(s=W(B,o,t,k,{}),T()),r.fillText(s.join(""),B,R+I),R+=u,P(B,R,k),r.restore(),void this.setBorder(e,i)}const j=t.split(""),C=R;let $=B,F="",A=0,H=0;for(let t=0;t<=j.length;t++){let e=j[t]||"";const i="\n"===e,o=""==e;e=i?"":e;let s=F+e,n=r.measureText(s).width;if(A>=y)break;if(n=n,$=B,n>a.width||i||o){let l=t;if(A++,F=o&&n<=a.width?s:F,A===y&&n>h){for(;r.measureText(`${F}...`).width>a.width&&!(F.length<=1);)F=F.substring(0,F.length-1);F+="..."}const c=Object.keys(M);let f="";if(c&&(f=W(B,c,F,n,{startIndex:H,endIndex:l}),T()),r.fillText(f.join(""),$,R+I),R+=u,P($,R,n),F=e,H=l+(i?1:0),R+u>C+d)break}else F=s}r.restore()}async source(t){if(await this.setFontSizeRate(),this.clear(),"{}"==JSON.stringify(t))return;if(!t.type){t.type="view",t.css=t.css||{};for(let e in t)["views","children","type","css"].includes(e)||(t.css[e]=t[e],delete t[e])}t?.css?.width||(t.css?t.css.width=this.root.width:t.css={width:this.root.width});const e=await this.create(t);return this.size=e.layout(),this.node=e,this.size}async create(t,e){if("image"==t.type&&!t.src&&!t.url||"qrcode"==t.type&&!t.text)return;if("none"==t?.css?.display)return void console.error("element display none");if(this.count+=1,"image"==t.type||"view"==t.type&&t.css?.backgroundImage){let e=null;const i=/url\((.+)\)/;t.css.backgroundImage&&i.exec(t.css.backgroundImage)?.[1]&&(e=i.exec(t.css.backgroundImage)?.[1]);let{width:o,height:r,path:s}=await n(t.src||e);if(["mp-weixin","mp-baidu","mp-qq","mp-toutiao"].includes(this.platform)){s=/^\.|^\/(?=[^\/])/.test(t.src||e)?`/${s}`:s}t.attributes=Object.assign(t.attributes||{},{width:o,height:r,path:s,src:s,naturalSrc:t.src||e})}const i=new u(t,e,this.root,this.ctx),o=t.views||t.children;if(o)for(let t=0;t<o.length;t++){const e=o[t],r=await this.create(e,i);r&&i.add(r)}return i}async drawNode(t){const{layoutBox:e,computedStyle:i,attributes:o,name:r,children:s}=t,{src:n,text:a}=t.attributes;if("view"===r?n?await this.drawPattern(o,e,i):this.drawView(e,i):"image"===r&&n?await this.drawImage(o,e,i,!1):"text"===r?this.drawText(a,e,i,o.replace):"qrcode"===r&&g?.api&&g.api.draw(a,this,e,i),this.progress+=1,!s)return;const h=Object.values?Object.values(s):Object.keys(s).map((t=>s[t]));for(const t of h)await this.drawNode(t)}async render(){this.init(),await function(t=0){return new Promise((e=>setTimeout(e,t)))}(30),await this.drawNode(this.node)}listen(t,e){if("progressChange"==t){let t=0;Object.defineProperty(this,"progress",{configurable:!0,set:i=>{t=i,e(i/this.count)},get:()=>t||0})}}save(t){try{const{fileType:e="png",quality:i=1}=t||{};return this.canvas.toDataURL(`image/${e}`,i)}catch(t){return console.log("image cross domain"),t}}}"web"==i&&(window.Painter=p),t.Painter=p,Object.defineProperty(t,"__esModule",{value:!0})}));
